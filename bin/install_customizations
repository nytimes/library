#!/usr/bin/env bash
if [[ -f ./.env ]];
  then
    echo "sourcing environment variables from .env"
    source ./.env
fi

echo "Checking for CUSTOMIZATION_GIT_REPO environment variable..."
if ! [[ -z ${CUSTOMIZATION_GIT_REPO} ]];
  then
    echo "Cloning custom repo...";
    # remove custom to allow for cloning to that directory name
    rm -rf ./custom;
    # clone specific branch if env set
    if ! [[ -z ${CUSTOMIZATION_GIT_REPO_BRANCH} ]];
      then
        echo "Cloning custom repo and branch...";
        git clone -b $CUSTOMIZATION_GIT_REPO_BRANCH $CUSTOMIZATION_GIT_REPO custom;
      else
        git clone $CUSTOMIZATION_GIT_REPO custom;
    fi;
    echo "Installing custom packages...";
    cd ./custom;
    npm i;
    # force overwriting of packages if necessary
    yes | cp -rf ./node_modules/* ../node_modules;
    # copy custom images/assets
    yes | cp -rf ./public/* ../public;
  else
    echo "Not found. Continuing with standard Library deploy";
fi;

echo "Done!"
